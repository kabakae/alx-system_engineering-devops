#!/usr/bin/env bash
# Check if script is run as root
if [[ $EUID -ne 0 ]]; then
   echo "This script must be run as root" 
   exit 1
fi

# Set Nginx to run as the nginx user
sed -i 's/^user .*;$/user nginx;/' /etc/nginx/nginx.conf

# Configure Nginx to listen on all active IPs on port 8080
sed -i 's/^ *listen .*;$/    listen 8080 default_server;/' /etc/nginx/sites-available/default

# Restart Nginx and check if the restart was successful
service nginx restart
if [ $? -ne 0 ]; then
    echo "Failed to restart Nginx"
    exit 1
fi

# Prevent attempting to remove Nginx if it's not installed
if ! dpkg -l nginx >/dev/null 2>&1; then
    echo "Nginx is not installed, skipping removal"
    exit 0
fi

# Prevent using apt-get remove
dpkg --purge --force-all nginx
